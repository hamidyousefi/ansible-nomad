log_level = "{{ nomad_log_level }}"
datacenter = "{{ nomad_datacenter }}"
data_dir = "/var/lib/nomad"
bind_addr = "0.0.0.0"
name = "{{ inventory_hostname }}"

advertise {
  http = "{{ ansible_host }}"
  rpc = "{{ ansible_host }}"
  serf = "{{ ansible_host }}"
}

server {
  enabled = true
  bootstrap_expect = {{ groups[nomad_servers_host_group] | length }}

  server_join {
    retry_join = [
      {% for host in groups[nomad_servers_host_group] %}
      "{{ hostvars[host].ansible_host }}"{{ "," if not loop.last }}
      {% endfor %}
    ]
    retry_max = 3
    retry_interval = "15s"
  }
}
